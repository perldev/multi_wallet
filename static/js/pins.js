var Pins={host:"https://btc-trade.com.ua",host_ws:"wss://btc-trade.com.ua",id:"",container:"",session:"",is_delete:false,ws:null,is_availible:false,mutex_busy:false,timer:null,attach2pin:function(c,b){if(Login.use_f2a){return}if(!document.getElementById(c)){return}Pins.timer=setInterval(function(){if(Pins.ws){Pins.ws.send(JSON.stringify({ping:true}))}},2000);Pins.id=c;Pins.container=b;var a=$.ajax({url:Pins.host+"/codes/start/12312asdasar34asda12",type:"GET",cache:false,error:function(d){my_alert("Не удалось создать соединение с сервером пин-паролей, сообщите пожайлуста об этом в поддержку")},success:function(d){$("#"+b).html(d);Pins.session=$("#secure_pin_session").val();$("#"+Pins.id).val(Pins.session);Pins.start_pin_listener(Pins.session)}})},start_pin_listener:function(Session){console.log("Connection");Pins.ws=new WebSocket(Pins.host_ws+"/command/"+Session);Pins.ws.onopen=function(){Pins.is_availible=true;console.log("Connected")};Pins.ws.onmessage=function(evt){Pins.mutex_busy=false;var received_msg=evt.data;var myObject=eval("("+received_msg+")");console.log("Received: "+received_msg);if(received_msg.ping){return}if(Pins.is_delete){Pins.is_delete=false;if(myObject.status){var val=$("#secure_pincode").val();$("#secure_pincode").val(val.substring(0,val.length-1))}}else{var val=$("#secure_pincode").val();if(myObject.status){$("#secure_pincode").val(val+"*")}}};Pins.ws.onclose=function(){Pins.is_availible=false;my_alert("Соединение   с сервером PIN оборвалось, перегрузите страницу, если не помогло обратитесь в службу поддержки")}},another_codes:function(){Pins.ws.onclose=null;Pins.ws.close();clearInterval(Pins.timer);Pins.attach2pin(Pins.id,Pins.container)},put_pin_key:function(a){if(!Pins.is_availible){my_alert("Мы потеряли связь  с сервером перегрузите страницу, если не помогло обратитесь в службу поддержки")}var b=a.id;if(Pins.mutex_busy){return}b=b.replace("pin_but_","");Pins.mutex_busy=true;js_txt=JSON.stringify({new_key:b});console.log("send "+js_txt);Pins.ws.send(js_txt)},del_pin_key:function(){if(!Pins.is_availible){my_alert("Мы потеряли связь  с сервером перегрузите страницу, если не помогло обратитесь в службу поддержки")}if(Pins.mutex_busy){return}console.log("delete");Pins.mutex_busy=true;Pins.is_delete=true;Pins.ws.send(JSON.stringify({del_key:true}))}};